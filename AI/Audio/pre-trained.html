<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Honk vs Emergency Sound Detection</title>
</head>
<body>
  <h2>Honk vs Emergency Sound Classifier</h2>

  <input type="file" id="audioInput" accept="audio/*" />
  <p id="status">Load an audio file (.wav / .mp3)</p>

  <pre id="output"></pre>

  <!-- Transformers.js -->
  <script type="module">
    import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1";

    const status = document.getElementById("status");
    const output = document.getElementById("output");
    const audioInput = document.getElementById("audioInput");

    status.textContent = "Loading model (first load may take ~20–30s)...";

    // Load Audio Classification pipeline
    const classifier = await pipeline(
      "audio-classification",
      "onnx-community/ast-finetuned-audioset-10-10-0.4593-ONNX"
    );

    status.textContent = "Model loaded. Upload an audio file.";

    audioInput.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      status.textContent = "Analyzing audio...";
      output.textContent = "";

      const results = await classifier(file, { topk: 10 });

      // Filter relevant classes
      const relevant = results.filter(r =>
        r.label.toLowerCase().includes("siren") ||
        r.label.toLowerCase().includes("horn")
      );

      output.textContent =
        "Detected relevant sounds:\n\n" +
        relevant.map(r =>
          `${r.label} → ${(r.score * 100).toFixed(2)}%`
        ).join("\n");

      status.textContent = "Done.";
    });
  </script>
</body>
</html>
