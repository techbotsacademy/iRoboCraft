<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Try HTML Yourself</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #04AA6D;
      color: white;
      padding: 10px 16px;
      font-size: 18px;
    }

    .container {
      flex: 1;
      display: flex;
    }

    textarea {
      width: 50%;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      border: none;
      outline: none;
      resize: none;
    }

    iframe {
      width: 50%;
      border: none;
      background: white;
    }

    button {
      background: #04AA6D;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background: #038e5a;
    }

    .toolbar {
      padding: 8px;
      background: #f1f1f1;
      border-bottom: 1px solid #ccc;
    }
  </style>
</head>
<body>

<header>
  Try HTML Yourself
</header>

<div class="toolbar">
  <button onclick="runCode()">Run â–¶</button>
</div>

<div class="container">
  <textarea id="code">
<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Arduino Jump Sprite</title>

  <style>
    #gameArea {
      width: 600px;
      height: 300px;
      border: 2px solid black;
      position: relative;
      background: #eaf6ff;
      overflow: hidden;
    }

    #ground {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40px;
      background: #654321;
    }

    #sprite {
      width: 50px;
      height: 50px;
      background: red;
      position: absolute;
      left: 275px;
      bottom: 40px; /* standing on ground */
      transition: bottom 0.2s, height 0.2s;
    }

    #debug {
      margin-top: 10px;
      height: 80px;
      overflow-y: auto;
      border: 1px solid #aaa;
      font-family: monospace;
      padding: 5px;
    }
  </style>
</head>

<body>

<button id="connectBtn">Connect to Arduino</button>

<div id="gameArea">
  <div id="sprite"></div>
  <div id="ground"></div>
</div>

<b>Debug:</b>
<div id="debug"></div>

<script>
let port;
let reader;
let buffer = "";

const sprite = document.getElementById("sprite");
const debug = document.getElementById("debug");

let isJumping = false;

document.getElementById("connectBtn").addEventListener("click", async () => {
  port = await navigator.serial.requestPort();
  await port.open({ baudRate: 9600 });
  readSerial();
});

async function readSerial() {
  const decoder = new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  const reader = decoder.readable.getReader();

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;

    handleCommand(value);
  }
}

function handleCommand(cmd) {
  debug.innerText += cmd + "\n";
  debug.scrollTop = debug.scrollHeight;

  if (cmd === "U") jump();
  if (cmd === "D") crouch();
}

function jump() {
  if (isJumping) return;

  isJumping = true;
  sprite.style.height = "50px";
  sprite.style.bottom = "140px"; // jump height

  setTimeout(() => {
    sprite.style.bottom = "40px"; // back to ground
    isJumping = false;
  }, 1000);
}

function crouch() {
  if (isJumping) return;

  sprite.style.height = "30px"; // crouch
  sprite.style.bottom = "40px"; // stay on ground
}
</script>

</body>
</html>
  </textarea>

  <iframe id="output"></iframe>
</div>

<script>
  function runCode() {
    const code = document.getElementById("code").value;
    const iframe = document.getElementById("output");
    iframe.srcdoc = code;
  }

  // Run once on load
  runCode();
</script>

</body>
</html>
